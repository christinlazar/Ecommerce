<!DOCTYPE HTML>
<html lang="en">


<!-- Mirrored from wp.alithemes.com/html/evara/evara-backend/page-form-product-1.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 01 Aug 2021 15:33:31 GMT -->
<head>
    <meta charset="utf-8">
    <title>Wild Monkey Clothing</title>
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title" content="">
    <meta property="og:type" content="">
    <meta property="og:url" content="">
    <meta property="og:image" content="">
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="/admin-assets/imgs/theme/favicon.svg">
    <!-- Template CSS -->
    <link href="/admin-assets/css/main.css" rel="stylesheet" type="text/css" />
</head>

<body>
    <div class="screen-overlay"></div>
    <!-- -------------------------INCLUDE------------------------- -->
    <%- include('sidenav') %>

    <main class="main-wrap">
        <%- include('adminheader') %>
        <section class="content-main">
            <div class="row">
                <div class="col-9">
                    <div class="content-header">
                        <h2 class="content-title">Add Coupon Here</h2>
                        <div>
                            <!-- <button class="btn btn-light rounded font-sm mr-5 text-body hover-up">Save to draft</button> -->
                           
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="card mb-4">
                        <div class="card-header">
                            <h4>Basic</h4>
                        </div>
                        <div class="card-body">
                            <form id="form" method="post" action="/admin/coupon">
                                <div class="mb-4">
                                    <label for="product_name" class="form-label">Coupon Name</label>
                                    <input type="text" placeholder="Type here" class="form-control" id="coupon" name="name">
                                    <p class="text text-danger" style="display:block;" id="couponError"></p>
                                </div>
                               
                                <div class="mb-4">
                                    <label for="product_name" class="form-label">Minimum Purchase</label>
                                    <input type="text" placeholder="Type here" class="form-control" id="min" name="purchase">
                                    <p class="text text-danger"  id="minError"></p>
                                </div>
                                <div class="row">
                                    <div class="col-lg-4">
                                        <div class="mb-4">
                                            <label class="form-label" >Coupon Code</label>
                                            <div class="row gx-2">
                                                <input  name="code" type="text" id="code" class="form-control" >
                                               
                                                <p class="text text-danger" style="display: block;" id="codeError"></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-4">
                                        <div class="mb-4">
                                            <label class="form-label" >Discount</label>
                                            <input name="discount" type="text" id="discount" class="form-control" >
                                            <p class="text text-danger" style="display:block" id="discountError"></p>
                                           
                                        </div>
                                    </div>

                                    <div class="col-lg-4">
                                        <div class="mb-4">
                                            <label class="form-label" for="expirationDate">Expiration Date</label>
                                            <input name="expirationDate" type="date" id="expirationDate" class="form-control">
                                            <p class="text text-danger" style="display:none" id="expirationDateError"></p>
                                        </div>
                                    </div>

                                    <button class="btn btn-light rounded font-sm mr-5 text-body hover-up" id="btn" type="submit"  >Add Coupon</button>
                                    <p class="text text-danger" style="display:none" id="submitError"></p>
                                   
                                </div>
                              
                        </div>
                    </div> <!-- card end// -->
                     <!-- card end// -->
                </div>

            </form>
            <div class="col-lg-6">
                
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Coupon Name</th>
                                    <th>Coupon code</th>
                                    <th>Minimum purchase</th>
                                    <th>Discount</th>
                                    <th > Expiration Date </th>
                                    <th class="text-end"> Action </th>
                                </tr>
                            </thead>
                            <tbody>
                               
                               <% if(locals.couponDetails){%>
                                <% couponDetails.forEach(element => { %>
                     
                                <tr>
                                    <td width="40%">
                                        <a href="#" class="itemside">
                                            <!-- <div class="left">
                                                <img src="/admin-assets//imgs/people/avatar1.jpg" class="img-sm img-avatar" alt="Userpic">
                                            </div> -->
                                            <div class="info pl-3">
                                                <p class="mb-0 title"><%= element.name%></p>
                                                <!-- <small class="text-muted">Seller ID: #439</small> -->
                                            </div>
                                        </a>
                                    </td>
                                    <td><%=element.code%></td>
                                    <!-- ----------------------- -->
                                 
                                        <td>Rs.<%=element.minimumPurchase%></td>
                                   
                                        <td>Rs.<%=element.discount%></td>
                                   
                                    <td><%=element.expirationDate%></td>
                                    <td class="text-end">

                                            <%if(element.is_active == true){%>
                                                <button onclick="hold(`<%=element._id%>`)" class="btn btn-sm btn-danger rounded font-sm mt-15 " >Hold</button>
                                            <%}%>
                                            <%if(element.is_active == false){%>
                                                <button onclick="unhold(`<%=element._id%>`)" class="btn btn-sm btn-brand rounded font-sm mt-15" >unhold</button>
                                            <%}%>
                                     
                                    </td>
                                </tr>
                            <% })}%>
                            </tbody>
                        </table> <!-- table-responsive.// -->
                    </div>
                </div> <!-- card-body end// -->
            </div>
            </div>

            
        </section> <!-- content-main end// -->
        <footer class="main-footer font-xs">
            <div class="row pb-30 pt-15">
                <div class="col-sm-6">
                    <!-- <script>
                    document.write(new Date().getFullYear())
                    </script> Â©, Evara - HTML Ecommerce Template .
                </div> -->
                <div class="col-sm-6">
                    <!-- <div class="text-sm-end">
                        All rights reserved
                    </div> -->
                </div>
            </div>
        </footer>
    </main>
    <script>

      function hold(couponId){

                    Swal.fire({
  title: "Are you sure?",
  text: "You really  want to block this coupon!",
  icon: "warning",
  showCancelButton: true,
  confirmButtonColor: "#3085d6",
  cancelButtonColor: "#d33",
  confirmButtonText: "Yes, Block it!"
}).then((result) => {
  if(result.isConfirmed) {
    Swal.fire({
      title: "Blocked!",
      text: "You have blocked the coupon.",
      icon: "success"
    })
    .then((result)=>{
    if(result.isConfirmed){
        fetch('/admin/hold',{
            method:"PATCH",
            headers:{
                "Content-Type":"application/json"
            },
            body:JSON.stringify({couponId:couponId})
        })
        .then(response=> response.json()).then(data=>{
            window.location.reload()
            console.log(data.message)
        })
        }
    })
}
})
      }


      function unhold(couponId){

                Swal.fire({
                title: "Are you sure?",
                text: "You really  want to unblock this coupon!",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                confirmButtonText: "Yes, unblock it!"
                }).then((result) => {
                if(result.isConfirmed) {
                Swal.fire({
                title: "unblocked!",
                text: "You have unblocked the coupon.",
                icon: "success"
                })
                .then((result)=>{
                if(result.isConfirmed){
                fetch('/admin/unhold',{
                method:"PATCH",
                headers:{
                "Content-Type":"application/json"
                },
                body:JSON.stringify({couponId:couponId})
                })
                .then(response=> response.json()).then(data=>{
                window.location.reload()
                console.log(data.message)
                })
                }
                })
                }
                })
                }
            
            const form = document.getElementById('form')
            const couponName = document.getElementById('coupon') 
            const couponError = document.getElementById('couponError') 
            const min = document.getElementById('min') 
            const minError = document.getElementById('minError') 
            const code = document.getElementById('code') 
            const codeError = document.getElementById('codeError')
            const discount = document.getElementById('discount') 
            const discountError = document.getElementById('discountError')
            const expirationDate = document.getElementById('xpirationDate') 
            const expirationDateError = document.getElementById('xpirationDateError')

                function validateCouponName(){
                    const couponNamePattern = /^[\w\s-]{1,50}$/
                    if(couponName.value.trim()==""){
                        couponError.innerHTML="Coupon Name is not valid" 
                        setTimeout(() => {
                            couponError.style.display="none"
                        }, 3000);
                    }
                    else if(!couponNamePattern.test(couponName.value)){
                        couponError.innerHTML="Coupon Name is not valid"
                        setTimeout(() => {
                            couponError.style.display="none"
                        }, 3000);
                      
                    }else{
                        couponError.innerHTML=""
                    }
                }


                function validateMinimumPurchase(){
                    const minimumPurchasePattern = /^\d+(\.\d{1,2})?$/
                    if(min.value.trim()==""){
                        minError.innerHTML="Minimun prurchase Amount is not valid" 
                        setTimeout(() => {
                            minError.style.display="none"
                        }, 3000);
                    }
                    else if(!minimumPurchasePattern.test(min.value)){
                        minError.innerHTML="Minimun prurchase Amount is not valid"
                        setTimeout(() => {
                            minError.style.display="none"
                        }, 3000);
                      
                    }else{
                        minError.innerHTML=""
                    }
                }


                function validateCouponCode(){
                    const couponPattern =/^[a-zA-Z0-9]{8}$/
                    if(code.value.trim()==""){
                        codeError.innerHTML="Coupon code is not valid" 
                        setTimeout(() => {
                            codeError.style.display="none"
                        }, 3000);
                    }
                    else if(!couponPattern.test(code.value)){
                        codeError.innerHTML="Coupon code is not valid"
                        setTimeout(() => {
                            codeError.style.display="none"
                        }, 3000);
                      
                    }else{
                        codeError.innerHTML=""
                    }
                }


                function validateDiscount(){
                    const discountPattern = /^\d+(\.\d{1,2})?$/
                    if(discount.value.trim()==""){
                        discountError.innerHTML="Discount Amount is not valid" 
                        setTimeout(() => {
                            discountError.style.display="none"
                        }, 3000);
                    }
                    else if(!discountPattern.test(discount.value)){
                        discountError.innerHTML="Discount Amount is not valid"
                        setTimeout(() => {
                            discountError.style.display="none"
                        }, 3000);
                      
                    }else{
                        discountError.innerHTML=""
                    }
                }

                form.addEventListener('submit',function(event){
                    validateCouponName();
                    validateMinimumPurchase()
                    validateCouponCode();
                    validateDiscount();

                    if(couponError.innerHTML||minError.innerHTML||discountError.innerHTML||codeError){
                        event.preventDefault;
                    }
                })

                couponName.addEventListener('blur',validateCouponName)
                min.addEventListener('blur',validateMinimumPurchase)
                code.addEventListener('blur',validateCouponCode)
                discount.addEventListener('blur',validateDiscount)

    </script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="/admin-assets/js/vendors/jquery-3.6.0.min.js"></script>
    <script src="/admin-assets/js/vendors/bootstrap.bundle.min.js"></script>
    <script src="/admin-assets/js/vendors/select2.min.js"></script>
    <script src="/admin-assets/js/vendors/perfect-scrollbar.js"></script>
    <script src="/admin-assets/js/vendors/jquery.fullscreen.min.js"></script>
    <!-- Main Script -->
    <script src="/admin-assets/js/main.js" type="text/javascript"></script>
</body>


<!-- Mirrored from wp.alithemes.com/html/evara/evara-backend/page-form-product-1.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 01 Aug 2021 15:33:32 GMT -->
</html>